<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Land Development Proforma</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">
  <div class="max-w-6xl mx-auto p-6">
    <h1 class="text-3xl font-bold text-center text-blue-700 mb-6">Land Development Proforma</h1>

    <section class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <div>
        <h2 class="text-xl font-semibold mb-4">Revenue Assumptions</h2>
        <label>Lots Sold <input type="number" id="lotsSold" class="input" placeholder="100"></label>
        <label>Avg. Lot Sale Price ($) <input type="number" id="avgLotPrice" class="input" placeholder="75000"></label>
      </div>
      <div>
        <h2 class="text-xl font-semibold mb-4">Development Costs</h2>
        <label>Acquisition Cost ($) <input type="number" id="acquisition" class="input" placeholder="1000000"></label>
        <label>Site Dev. Cost ($) <input type="number" id="siteCost" class="input" placeholder="2500000"></label>
        <label>Soft Costs ($) <input type="number" id="softCost" class="input" placeholder="500000"></label>
        <label>Other Costs ($) <input type="number" id="otherCost" class="input" placeholder="300000"></label>
      </div>
    </section>

    <button onclick="calculateProforma()" class="bg-blue-700 text-white px-6 py-2 rounded shadow hover:bg-blue-800">Calculate</button>
    <button onclick="exportXLS()" class="bg-green-600 text-white px-6 py-2 rounded shadow ml-2 hover:bg-green-700">Export XLSX</button>

    <div id="results" class="mt-8"></div>

    <canvas id="summaryChart" class="my-12"></canvas>
  </div>

  <script>
    function calculateProforma() {
      const lotsSold = +document.getElementById('lotsSold').value || 0;
      const avgLotPrice = +document.getElementById('avgLotPrice').value || 0;
      const acquisition = +document.getElementById('acquisition').value || 0;
      const siteCost = +document.getElementById('siteCost').value || 0;
      const softCost = +document.getElementById('softCost').value || 0;
      const otherCost = +document.getElementById('otherCost').value || 0;

      const totalRevenue = lotsSold * avgLotPrice;
      const totalCost = acquisition + siteCost + softCost + otherCost;
      const grossProfit = totalRevenue - totalCost;
      const irr = (((grossProfit / totalCost) / 5) * 100).toFixed(2); // basic IRR estimate

      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = `
        <div class="bg-white p-6 rounded shadow">
          <h2 class="text-xl font-bold mb-4">Results Summary</h2>
          <p>Total Revenue: $${totalRevenue.toLocaleString()}</p>
          <p>Total Development Cost: $${totalCost.toLocaleString()}</p>
          <p>Gross Profit: $${grossProfit.toLocaleString()}</p>
          <p>Estimated IRR (5 Year): ${irr}%</p>
        </div>`;

      if (window.chart) window.chart.destroy();
      const ctx = document.getElementById('summaryChart').getContext('2d');
      window.chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Revenue', 'Cost', 'Profit'],
          datasets: [{
            label: 'Land Dev Summary ($)',
            data: [totalRevenue, totalCost, grossProfit],
            backgroundColor: ['#3b82f6', '#f87171', '#10b981']
          }]
        }
      });
    }

    function exportXLS() {
      const data = [[
        'Metric', 'Amount'
      ], [
        'Lots Sold', document.getElementById('lotsSold').value
      ], [
        'Avg. Lot Price', document.getElementById('avgLotPrice').value
      ], [
        'Acquisition Cost', document.getElementById('acquisition').value
      ], [
        'Site Dev. Cost', document.getElementById('siteCost').value
      ], [
        'Soft Costs', document.getElementById('softCost').value
      ], [
        'Other Costs', document.getElementById('otherCost').value
      ]];
      const ws = XLSX.utils.aoa_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'LandDev');
      XLSX.writeFile(wb, 'Land_Dev_Proforma.xlsx');
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .input { width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 6px; margin-bottom: 1rem; }
  </style>
</body>
</html>
